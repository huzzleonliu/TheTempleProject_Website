services:
  frontend:
    container_name: tp_frontend  # 容器名称
    build: ./frontend  # 前端 Dockerfile 目录
    networks:
      - the_temple_project_net
    environment:
      - VITE_API_BASE_URL=http://backend:8082  # 前端环境变量指向后端
    expose:
      - "8081"

  backend:
    container_name: tp_backend  # 容器名称
    build: ./backend  # 后端 Dockerfile 目录
    networks:
      - the_temple_project_net
    environment:
      - PORT=8082
    expose:
      - "8082"
    depends_on:
      - database  # 确保数据库容器先启动

  database:
    container_name: tp_database
    build: ./database  
    networks:
      - the_temple_project_net
    expose:
      - "5432"
    ports:
      - "8083:5432"

  resource:
    container_name: tp_resource  # 容器名称
    build: ./resource  # 资源服务 Dockerfile 目录
    networks:
      - the_temple_project_net
    environment:
      - PORT=8084
    expose:
      - "8084"
    ports:
      - "8084:80"

  nginx:
    container_name: tp_nginx  # 容器名称
    build: ./nginx  # Dockerfile 所在目录
    ports:
      - "8080:80"
    networks:
      - the_temple_project_net
    depends_on:
      - frontend
      - backend
      - resource  # 确保前端、后端和资源服务先启动
    volumes:
      - type: bind
        source: ./nginx/nginx/
        target: /etc/nginx/ # 挂载 Nginx 配置文件目录
        read_only: true

networks:
  the_temple_project_net:  # 自定义网络确保容器间通过名称通信
